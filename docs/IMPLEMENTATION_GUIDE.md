# 実装ガイド（実装記録・今後課題）

最終更新: 2026-02-25

このドキュメントは、現時点の実装状況・DB構成・既知課題・次の優先実装をまとめた開発ガイドです。  
新しい作業に着手する前に、まず本ページを確認してください。

## 1. 実装記録

### 1-1. ホームダッシュボード

- 左サイドバー（開閉対応）
  - メニュー: ホーム / 新規事案作成 / 事案検索 / 病院検索 / 設定
  - フッター: 救急隊名 + 隊ID表示
- メイン
  - 過去事案一覧テーブル
  - 「新規事案作成」ボタン
  - 行右端「詳細」ボタンから事案詳細へ遷移

### 1-2. 事案情報ページ（`/cases/new`, `/cases/[caseId]`）

- タブ構成
  - 基本情報
  - 概要_バイタル
  - 送信履歴
- 基本情報タブ（実装済み）
  - 氏名（不明トグル）
  - 性別（3種）
  - 生年月日（西暦/和暦）+ 年齢自動計算
  - 住所、電話番号（ハイフン自動整形）
  - ADL（要支援1〜2 / 要介護1〜5）
  - アレルギー、体重
  - 既往症6枠 + かかりつけ（病院候補サジェスト + 自由入力許容）
- 概要_バイタル
  - 要請概要 / 本人主訴のテキスト入力は配置済み
  - 基本バイタル詳細項目は未完了（段階実装中）

### 1-3. 病院検索ページ（`/hospitals/search`）

- タブ構成
  - 検索条件
  - 検索結果
  - 送信履歴（プレースホルダー）
- 検索条件
  - 直近検索（住所 + 診療科目 + OR/AND ボタン）
  - 市区名検索（候補リスト選択）
  - 個別検索（病院名候補リスト選択）
- 検索結果
  - テーブル表示（20件ページング）
  - 列: 病院ID / 病院名 / 科目 / 住所 / 電話番号 / 距離
  - 右端チェックボックス + 下部「受け入れ要請送信」ボタン
- 個別検索結果
  - 病院情報カード + 診療科目カード（正式名称表示、不可はグレーアウト、6列表示）

## 2. DB構成（Neon / PostgreSQL）

### 2-1. 使用テーブル

- `hospitals`
- `emergency_teams`
- `cases`
- `medical_departments`
- `hospital_departments`

### 2-2. データ投入関連

- `scripts/load_neon_seed.py`
  - 病院CSV取り込み
  - 住所ジオコーディング（緯度経度）
  - 既存データ削除後の再投入
- `scripts/setup_departments.sql`
  - 診療科目マスタ作成（正式名称/略称）
- `scripts/seed_hospital_departments_demo.sql`
  - 病院-診療科目のデモ紐づけ
- `scripts/execute_sql.js`
  - SQL実行ユーティリティ

## 3. API

- `GET /api/hospitals/suggest?q=...`
  - 病院名候補サジェスト
- `POST /api/hospitals/recent-search`
  - 直近検索 / 市区名検索 / 個別検索の実行

## 4. 既知課題

- 一部ファイルで文字化けが発生している可能性がある（要 UTF-8 統一確認）
- 事案情報ページの「概要_バイタル」詳細実装が未完
- 送信履歴タブ（事案・病院）の永続化実装が未完
- 受け入れ要請送信後の状態管理（履歴・結果反映）が未実装

## 5. 今後の優先実装

1. 事案情報「概要_バイタル」タブの段階実装（要請概要/主訴の次に基本バイタル）
2. 各所見（神経・循環器・消化器・外科）のフォーム実装
3. 送信履歴の DB 永続化と一覧表示
4. 受け入れ要請送信フロー（チェック対象の送信・結果管理）
5. 文字コードの全体点検（UTF-8統一）

## 6. 開発運用ルール（当面）

- UI 文言は日本語を標準とする
- 主要利用端末は iPad横 / PC（モバイル最適化は低優先）
- 仕様追加時はこのドキュメントへ実装記録と未対応項目を追記する
